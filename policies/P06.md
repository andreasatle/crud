## POLICY-P06 — Domain ↔ Persistence Mapping

### Purpose

To define how authoritative domain entities are persisted without leaking persistence concerns into domain logic.

### Rules

1. **Domain entities MUST be persistence-agnostic.**

   * Domain entities MUST NOT contain ORM annotations, base classes, or metadata.
   * Domain entities MUST NOT depend on SQLAlchemy or database concepts.

2. **Persistence entities MUST be ORM-mapped classes.**

   * ORM-mapped classes define tables, columns, keys, and relationships.
   * Persistence entities MAY differ structurally from domain entities.

3. **Mapping between domain and persistence entities MUST be explicit.**

   * Conversion logic MUST be implemented in a dedicated mapping layer.
   * No implicit ORM magic (e.g. automatic session-bound mutation) is allowed.

4. **Domain entities define identity; persistence assigns storage keys.**

   * Domain entities MAY contain stable identifiers.
   * Persistence-layer identifiers MUST map to domain identity explicitly.

5. **Invariants apply to domain entities, not ORM entities.**

   * ORM entities are storage artifacts.
   * Domain entities remain the source of truth.

### Rationale

* Prevents ORM leakage into domain logic.
* Allows persistence strategy changes without rewriting invariants.
* Makes identity, ownership, and lifecycle explicit.
* Preserves your “invariants are authority” principle.
